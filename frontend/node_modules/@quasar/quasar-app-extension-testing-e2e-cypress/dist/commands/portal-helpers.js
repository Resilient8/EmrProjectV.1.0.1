"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerPortalHelpers = void 0;
const lodash_1 = require("lodash");
// TODO: make cy.dataCy Withinable as cy.get
function getDataCySelector(dataCy) {
    return `[data-cy=${dataCy}]`;
}
function portalDerivateCommand(selectorDefault, selectorSuffixes, fnOrOptions) {
    selectorSuffixes = (0, lodash_1.castArray)(selectorSuffixes);
    const { dataCy = undefined, persistent = false, selector = selectorDefault, } = typeof fnOrOptions === 'function' ? {} : fnOrOptions;
    const fn = typeof fnOrOptions === 'function' ? fnOrOptions : fnOrOptions.fn;
    const portalSelector = selectorSuffixes
        .map((selectorSuffix) => `${dataCy ? getDataCySelector(dataCy) : selector}${selectorSuffix}`)
        .join(',');
    return cy.withinPortal(portalSelector, fn).then(($el) => {
        if (!persistent) {
            cy.wrap($el).should('not.exist');
        }
    });
}
function registerPortalHelpers() {
    Cypress.Commands.add('withinPortal', function (selectorOrOptions, fn) {
        const selector = typeof selectorOrOptions === 'string'
            ? selectorOrOptions
            : getDataCySelector(selectorOrOptions.dataCy);
        return (cy
            .get(selector, {
            withinSubject: Cypress.$('body'),
        })
            // Assert there's only one portal-based element that match the selection before continuing,
            // avoids delay due to transitions
            .should('have.length', 1)
            .within(fn));
    });
    Cypress.Commands.add('withinSelectMenu', function (fnOrOptions) {
        return portalDerivateCommand('.q-menu', '[role=listbox]', fnOrOptions);
    });
    Cypress.Commands.add('withinMenu', function (fnOrOptions) {
        // QMenu only have a role attribute from Quasar v2.8.4 onwards
        // Without the suffixes specification this would match select options menus too
        return portalDerivateCommand('.q-menu', [':not([role])', '[role=menu]'], fnOrOptions);
    });
    Cypress.Commands.add('withinDialog', function (fnOrOptions) {
        return portalDerivateCommand('.q-dialog', '', fnOrOptions);
    });
}
exports.registerPortalHelpers = registerPortalHelpers;
//# sourceMappingURL=portal-helpers.js.map