import { Request, Response } from 'express';
// âœ… Import Model à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸¡à¸µ (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š path à¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸à¸±à¸šà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“)
import User from '../models/user'; 

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸ªà¸³à¸«à¸£à¸±à¸šà¸«à¸™à¹‰à¸² Admin)
export const getUsers = async (req: Request, res: Response) => {
  try {
    // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¸•à¸²à¸£à¸²à¸‡ users
    const users = await User.findAll({
      // ðŸ”’ à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢: à¹„à¸¡à¹ˆà¸”à¸¶à¸‡à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸¡à¸²à¹à¸ªà¸”à¸‡
      attributes: { exclude: ['password_hash'] }, 
      
      // ðŸ“… à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š: à¹€à¸­à¸²à¸„à¸™à¸ªà¸¡à¸±à¸„à¸£à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¸‚à¸¶à¹‰à¸™à¸à¹ˆà¸­à¸™
      order: [['created_at', 'DESC']] 
    });

    // à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸¥à¸±à¸šà¹„à¸›à¹ƒà¸«à¹‰ Frontend
    res.status(200).json(users);

  } catch (error: any) {
    console.error('Error fetching users:', error);
    res.status(500).json({ 
      message: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰', 
      error: error.message 
    });
  }
};

// (à¹à¸–à¸¡) à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸£à¸²à¸¢à¸„à¸™à¸•à¸²à¸¡ ID
export const getUserById = async (req: Request, res: Response) => {
  try {
    const { id } = req.params;
    const user = await User.findByPk(id, {
      attributes: { exclude: ['password_hash'] }
    });

    if (!user) {
      return res.status(404).json({ message: 'à¹„à¸¡à¹ˆà¸žà¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸™à¸µà¹‰' });
    }

    res.status(200).json(user);
  } catch (error: any) {
    res.status(500).json({ message: 'Server Error', error: error.message });
  }
};